<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPD | GLOBAL ARCHIVIST</title>
    <script>
        // 1. SECURITY GATE
        var password = prompt("ENTER GPD ACCESS CODE:");
        if (password != "1042") { 
            alert("ACCESS DENIED"); 
            window.location.href = "https://www.google.com"; 
        }

        const GITHUB_TOKEN = "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";
        const REPO_OWNER = "citizencash";
        const REPO_NAME = "Gpd--terminal";

        async function logCase() {
            const officer = document.getElementById('officer').value;
            const suspect = document.getElementById('suspect').value;
            if(!officer || !suspect) return alert("FIELDS REQUIRED");

            try {
                // Fetch the current database.json file
                const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/database.json`);
                const file = await res.json();
                const content = JSON.parse(atob(file.content));
                
                // Add the new case
                content.push({ officer, suspect, time: new Date().toLocaleString() });

                // Push back to GitHub
                await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/database.json`, {
                    method: "PUT",
                    headers: { "Authorization": `token ${GITHUB_TOKEN}` },
                    body: JSON.stringify({
                        message: "Archive Update",
                        content: btoa(JSON.stringify(content)),
                        sha: file.sha
                    })
                });

                alert("SECURED IN GLOBAL ARCHIVE");
                location.reload();
            } catch (err) {
                alert("Connection Error. Check if database.json exists.");
            }
        }

        async function loadArchive() {
            try {
                const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/database.json`);
                const file = await res.json();
                const data = JSON.parse(atob(file.content));
                const list = document.getElementById('archive-list');
                if(data.length === 0) {
                    list.innerHTML = "NO RECORDS FOUND";
                } else {
                    list.innerHTML = data.reverse().map(c => `<div>> ${c.time}<br>OFFICER: ${c.officer} | SUSPECT: ${c.suspect}</div><hr>`).join('');
                }
            } catch (e) {
                document.getElementById('archive-list').innerHTML = "ARCHIVE OFFLINE";
            }
        }
        window.onload = loadArchive;
    </script>
</head>
<body style="background:#030507; color:#00f2ff; font-family:monospace; padding:15px; text-transform:uppercase;">
    <h2>[ GPD TERMINAL ]</h2>
    <input type="text" id="officer" placeholder="OFFICER NAME" style="background:#000; color:#0ff; border:1px solid #0ff; width:90%; padding:10px; margin-bottom:10px;">
    <input type="text" id="suspect" placeholder="SUSPECT NAME" style="background:#000; color:#0ff; border:1px solid #0ff; width:90%; padding:10px; margin-bottom:10px;">
    <button onclick="logCase()" style="background:#00ff95; color:#000; width:95%; padding:15px; font-weight:bold;">LOG CASE</button>

    <h3 style="margin-top:30px; color:#ffb700;">[ GLOBAL ARCHIVE ]</h3>
    <div id="archive-list" style="border:1px solid #333; padding:10px; background:#000; min-height:100px;">LOADING...</div>
</body>
</html>
