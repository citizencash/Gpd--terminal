<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GPD | GLOBAL ARCHIVIST</title>
    <style>
        :root { 
            --bg: #030507; --glass: rgba(10, 15, 20, 0.98); --border: #1a2a3a; 
            --accent: #00f2ff; --success: #00ff95; --danger: #ff3c3c; --text: #a0c4d1; --warn: #ffcc00;
        }
        body { 
            background: var(--bg); color: var(--text); font-family: 'Courier New', monospace; 
            padding: 10px; margin: 0; background-image: radial-gradient(circle at 50% 50%, #0d1a21 0%, #05080a 100%);
        }
        .hud-container { max-width: 600px; margin: auto; display: flex; flex-direction: column; gap: 15px; }
        .module { 
            background: var(--glass); border: 1px solid var(--border); padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8); border-top: 2px solid var(--accent);
        }
        h2 { color: var(--accent); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px; margin: 0 0 15px 0; border-bottom: 1px solid var(--border); padding-bottom: 5px;}
        label { display: block; font-size: 0.65rem; color: var(--accent); margin-bottom: 5px; text-transform: uppercase; }
        input { 
            background: rgba(0,0,0,0.8); border: 1px solid var(--border); color: #fff; 
            padding: 12px; width: 100%; box-sizing: border-box; font-size: 16px !important; border-radius: 2px; margin-bottom: 5px;
        }
        .btn { 
            background: none; border: 1px solid var(--accent); color: var(--accent); 
            padding: 12px; cursor: pointer; text-transform: uppercase; font-weight: bold; font-size: 0.8rem;
        }
        .btn-add { background: var(--accent); color: #000; width: 100%; margin-top: 10px; border: none; }
        .btn-log { background: var(--success); color: #000; border: none; width: 100%; font-size: 1rem; margin-top: 15px; }
        .btn-dispose { font-size: 0.6rem; border: 1px solid var(--danger); color: var(--danger); padding: 8px; width: 100%; margin-top: 10px; background: rgba(255, 60, 60, 0.1); }
        .log-entry { background: rgba(0,0,0,0.4); border: 1px solid var(--border); padding: 12px; margin-bottom: 10px; border-left: 4px solid var(--accent); font-size: 0.75rem; }
    </style>
</head>
<body>

<div class="hud-container">
    <div class="module">
        <h2>[ COMMAND TERMINAL ]</h2>
        <div style="display:flex; gap:10px;">
            <div style="flex:1">
                <label>OFFICER</label>
                <input type="text" id="officer" placeholder="Badge ID" onchange="saveOfc()">
            </div>
            <div style="flex:1">
                <label>SUSPECT</label>
                <input type="text" id="suspect" placeholder="Subject Name">
            </div>
        </div>
        <input type="text" id="assetSearch" placeholder="Asset search..." onkeyup="filterAssets()">
        <div id="suggestionBox" style="display:none; background:#000; border:1px solid var(--accent); position:absolute; z-index:10;"></div>
        <button class="btn btn-add" onclick="addConfirmed()">ADD TO MANIFEST</button>
    </div>

    <div class="module">
        <h2>[ SEIZURE MANIFEST ]</h2>
        <table id="manifestTable">
            <tbody id="lockerBody"></tbody>
        </table>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:15px;">
            <span id="totalDisplay" style="font-size:1.5rem; color:var(--success);">0 U</span>
            <button class="btn btn-log" style="width:150px;" onclick="archive()">LOG CASE</button>
        </div>
    </div>

    <div class="module">
        <h2>[ GLOBAL PRECINCT ARCHIVES ]</h2>
        <div id="logBody">SYNCING...</div>
    </div>
</div>

<script>
    const API_URL = "https://sheetdb.io/api/v1/sn9w3fnrrq26j";
    let locker = [];

    window.onload = () => {
        document.getElementById('officer').value = localStorage.getItem('gpd_ofc_name') || '';
        renderArchive();
    };

    function saveOfc() { localStorage.setItem('gpd_ofc_name', document.getElementById('officer').value); }
    
    function addConfirmed() {
        const item = document.getElementById('assetSearch').value;
        if(!item) return;
        locker.push({ name: item, qty: 1 });
        updateLocker();
    }

    function updateLocker() {
        const body = document.getElementById('lockerBody');
        body.innerHTML = '';
        locker.forEach((item, idx) => {
            body.innerHTML += `<tr><td>${item.name}</td><td><button onclick="locker.splice(${idx},1);updateLocker()">X</button></td></tr>`;
        });
    }

    async function archive() {
        const ofc = document.getElementById('officer').value;
        const sus = document.getElementById('suspect').value;
        const items = locker.map(i => i.name).join(", ");
        
        try {
            await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    data: [{ officer: ofc, suspect: sus, timestamp: items }] // Simplified for easier deletion
                })
            });
            alert("LOGGED");
            locker = []; updateLocker(); renderArchive();
        } catch (e) { alert("ERROR"); }
    }

    async function disposeEvidence(susName) {
        if(!confirm("PERMANENTLY DISPOSE OF THIS RECORD?")) return;
        
        // This targets the row by Suspect Name only - much more reliable
        try {
            const res = await fetch(`${API_URL}/suspect/${susName}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            });
            const result = await res.json();
            
            if(result.deleted > 0) {
                alert("EVIDENCE DISPOSED");
            } else {
                alert("RECORD NOT FOUND - Refreshing...");
            }
            renderArchive();
        } catch (e) { alert("SYSTEM ERROR"); }
    }

    async function renderArchive() {
        const body = document.getElementById('logBody');
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            body.innerHTML = '';
            data.reverse().forEach(h => {
                const s = h.suspect || h.Suspect;
                const o = h.officer || h.Officer;
                body.innerHTML += `
                    <div class="log-entry">
                        <b>OFFICER: ${o}</b><br>
                        SUSPECT: ${s}<br>
                        <button class="btn btn-dispose" onclick="disposeEvidence('${s}')">DISPOSE RECORD</button>
                    </div>`;
            });
        } catch (e) { body.innerHTML = "OFFLINE"; }
    }
</script>
</body>
</html>
